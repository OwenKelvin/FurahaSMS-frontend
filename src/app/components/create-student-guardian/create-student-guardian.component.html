<h1>Student Guardian Details</h1>
<form [formGroup]="userIdentificaionForm">
  <button type="button" class='icon-plus-circled btn btn-primary mt-3' (click)="addGuardians()">add <span
      class="sr-only">Guardian form section</span></button>
  <section formArrayName="guardians">
    <fieldset *ngFor="let guardian of guardians.controls; let i = index" [formGroupName]="i">
      <legend>
        <h2>Enter Details for the {{ i + 1 | ordinal }} Guardian</h2>
      </legend>
      <button type="button" style="float: right" (click)="removeGuadian(i)" [disabled]="guardians.controls.length === 1"
        class="btn btn-warning">remove</button>
      <fieldset>
        <legend>
          <h3>Email and Phone Number</h3>
        </legend>
        <section class="d-flex justify-content-between flex-wrap">
          <section class="col-lg-5">

            <app-input label='Email' id="{{ 'email' + i }}" type="email" placeholder="Please Enter Email"
              formControlName="email"></app-input>
          </section>
          <section class="col-sm-6 col-md-4 col-lg-3" *ngIf="confirmData[i]">
            User with the email Exists. Do You wish to Use this Email?
            <button (click)="updateFieldsForEmail(i)" style="margin-left: 15px" type="button" mat-raised-button
              color="primary">Yes</button>
            <button (click)="clearEmail(i)" style="margin-left: 15px" type="button" mat-raised-button
              color="warn">No</button>
          </section>
          <section class="col-lg-6">
              <app-tel-input
                label='Phone Number'
                placeholder='Enter phone number'
                formControlName="phoneNumber"></app-tel-input>
            </section>
          <section [hidden]="confirmData[i]" formGroupName="phoneDetails" class="col-sm-6 col-md-4 col-lg-6"
            class="phone">
            
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <select formControlName="phoneCode" (selected)="updateSelectedPhone(i)" [(value)]="selectedPhoneCode"
                  (blur)="validatePhone(i)" id="{{ 'phoneCode' + i}}">
                  <option>KE(+254)</option>
                  <option *ngFor="let country of countries" [value]="country.code">
                    <span class="flag-icon flag-icon-{{ country.country | lowercase}}"></span>
                    {{ country.country }} (+{{ country.code }})
                  </option>
                </select>
                <input class="form-control" (blur)="validatePhone(i)" id="{{ 'phoneNumber' + i}}" type="tel"
                  placeholder="Phone Number" formControlName="phoneNumber">
              </div>
            </div>
          </section>
        </section>
      </fieldset>
      <fieldset>
        <legend>
          <h3>Name</h3>
        </legend>
        <section class='d-flex flex-wrap'>
          <section class='col-lg-4 col-sm-6 col-xs-12'>
            <app-input [triggerValidation]='triggerValidation' placeholder='Enter First Name' [id]="'firstName' + i"
              label='First Name' formControlName='firstName'>
            </app-input>
          </section>
          <section class='col-lg-4 col-sm-6 col-xs-12'>
            <app-input [triggerValidation]='triggerValidation' placeholder='Enter Last Name' [id]="'lastName' + i"
              label='Last Name' formControlName='lastName'>
            </app-input>
          </section>
          <section class='col-lg-4 col-sm-6 col-xs-12'>
            <app-input [id]="'middleName' + i" placeholder='Enter Middle Name' label='middle Name'
              formControlName='middleName'>
            </app-input>
          </section>
          <section class='col-lg-4 col-sm-6 col-xs-12'>
            <app-input [id]="'otherNames' + i" placeholder='Enter Other Names' label='Other Names'
              formControlName='otherNames'>
            </app-input>
          </section>
        </section>
      </fieldset>
      <fieldset [hidden]="confirmData[i]">
        <legend>
          <h2>Other Details</h2>
        </legend>
        <section class='row'>
          <section class='col-lg-4 col-md-4 col-sm-6 col-xs-12'>
            <input (keyup)="validateRelation(i)" id="{{ 'relation' + i }}" type="text"
              placeholder="Relationship To Student" formControlName="relation" matInput>
          </section>
          <section class='col-lg-4 col-md-4 col-sm-6 col-xs-12'>
            <app-select id="{{ 'gender' + i}}" formControlName="gender" placeholder="Gender" type='gender'>
            </app-select>
          </section>
          <section class='col-lg-4 col-md-4 col-sm-6 col-xs-12'>
            <app-input type='date' placeholder="Date Of Birth" formControlName="dateOfBirth"
              (blur)="validateDateOfBirth(i)"></app-input>
          </section>
          <section class='col-lg-4 col-md-4 col-sm-6 col-xs-12'>
            <app-input matInput placeholder="Birth Certificate Number" formControlName="birthCertNumber"></app-input>
          </section>
          <section class='col-lg-4 col-md-4 col-sm-6 col-xs-12'>

            <app-select id="{{ 'religion' + i}}" formControlName="religion" placeholder="Religion" label='religion'
              type='religion'></app-select>
          </section>
        </section>
      </fieldset>
    </fieldset>
  </section>
</form>